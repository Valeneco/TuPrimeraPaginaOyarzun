{% extends 'base.html' %}

{% block titulo %} Pagos AP Pendientes {% endblock %}

{% block contenido %}
<div class="container my-5">
    <h2 class="mb-4 text-center">{{ page_title }}</h2>
    
    <p class="text-center">Esta lista simula el estado de las **Cuentas por Pagar (AP)** de proveedores, gestionadas por Bill.com.</p>

    <div class="card shadow-sm p-4">
        {% for vendor in vendors %}
        <div class="accordion mb-2" id="vendorAccordion-{{ vendor.pk }}">
            <div class="accordion-item">
                <h2 class="accordion-header" id="heading-{{ vendor.pk }}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ vendor.pk }}" aria-expanded="false" aria-controls="collapse-{{ vendor.pk }}">
                        <strong>Proveedor: {{ vendor.name }}</strong> ({{ vendor.email }})
                    </button>
                </h2>
                <div id="collapse-{{ vendor.pk }}" class="accordion-collapse collapse" aria-labelledby="heading-{{ vendor.pk }}" data-bs-parent="#vendorAccordion-{{ vendor.pk }}">
                    <div class="accordion-body">
                        {% with vendor_invoices=vendor.vendorinvoice_set.all %}
                        {% if vendor_invoices %}
                            <h5>Facturas Pendientes:</h5>
                            <ul class="list-group">
                                {% for inv in vendor_invoices %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ inv.invoice_number }} | Vence: {{ inv.due_date }}
                                    <span class="badge bg-{{ inv.status|lower|cut:'pending'|yesno:'warning,success' }} text-dark">${{ inv.amount|floatformat:2 }} - {{ inv.status }}</span>
                                </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="text-muted">No hay facturas registradas para este proveedor.</p>
                        {% endif %}
                        {% endwith %}
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
            <div class="alert alert-info text-center" role="alert">
                No hay proveedores registrados.
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}